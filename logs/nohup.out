Traceback (most recent call last):
  File "/mlx_devbox/users/liuhao.200207/playground/files/train.py", line 1, in <module>
    from utils import *
  File "/mlx_devbox/users/liuhao.200207/playground/files/utils.py", line 87
    return pickle_data
                      ^
IndentationError: unindent does not match any outer indentation level
[2025-04-23 21:28:26,926] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
Warning: The cache directory for DeepSpeed Triton autotune, /root/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
INFO 04-23 21:28:29 __init__.py:183] Automatically detected platform cuda.
Traceback (most recent call last):
  File "/mlx_devbox/users/liuhao.200207/playground/files/train.py", line 13, in <module>
    peft_config=get_peft_config(model_config),
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mlx_devbox/users/liuhao.200207/playground/nlp_env/lib/python3.11/site-packages/trl/trainer/utils.py", line 904, in get_peft_config
    raise ValueError(
ValueError: You need to have PEFT library installed in your environment, make sure to install `peft`. Make sure to run `pip install -U peft`.
[2025-04-23 21:36:30,991] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
Warning: The cache directory for DeepSpeed Triton autotune, /root/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
INFO 04-23 21:36:33 __init__.py:183] Automatically detected platform cuda.
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:15<00:15, 15.85s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:28<00:00, 14.44s/it]
Detected kernel version 5.4.143, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
  0%|          | 0/100 [00:00<?, ?it/s]`use_cache=True` is incompatible with gradient checkpointing. Setting `use_cache=False`.
  1%|          | 1/100 [01:19<2:11:44, 79.85s/it]  2%|▏         | 2/100 [02:08<1:40:20, 61.44s/it]  3%|▎         | 3/100 [04:51<2:54:24, 107.88s/it]  4%|▍         | 4/100 [07:07<3:10:13, 118.89s/it]  5%|▌         | 5/100 [17:39<8:01:32, 304.13s/it]  6%|▌         | 6/100 [19:52<6:24:54, 245.69s/it]  7%|▋         | 7/100 [26:53<7:49:42, 303.04s/it]  8%|▊         | 8/100 [30:11<6:53:37, 269.76s/it]  9%|▉         | 9/100 [32:15<5:40:00, 224.18s/it] 10%|█         | 10/100 [35:17<5:16:33, 211.04s/it]                                                    10%|█         | 10/100 [35:17<5:16:33, 211.04s/it] 11%|█         | 11/100 [40:11<5:50:34, 236.35s/it] 12%|█▏        | 12/100 [40:54<4:20:26, 177.57s/it] 13%|█▎        | 13/100 [42:02<3:29:35, 144.54s/it] 14%|█▍        | 14/100 [46:34<4:22:19, 183.02s/it] 15%|█▌        | 15/100 [47:43<3:30:28, 148.57s/it] 16%|█▌        | 16/100 [49:19<3:06:04, 132.91s/it] 17%|█▋        | 17/100 [59:52<6:31:35, 283.08s/it] 18%|█▊        | 18/100 [1:02:24<5:33:08, 243.76s/it] 19%|█▉        | 19/100 [1:04:14<4:34:51, 203.60s/it] 20%|██        | 20/100 [1:08:18<4:47:26, 215.58s/it]                                                      20%|██        | 20/100 [1:08:18<4:47:26, 215.58s/it] 21%|██        | 21/100 [1:10:38<4:14:09, 193.03s/it] 22%|██▏       | 22/100 [1:14:52<4:34:53, 211.45s/it] 23%|██▎       | 23/100 [1:16:53<3:56:13, 184.07s/it] 24%|██▍       | 24/100 [1:18:56<3:30:12, 165.95s/it] 25%|██▌       | 25/100 [1:29:33<6:23:56, 307.15s/it] 26%|██▌       | 26/100 [1:40:07<8:19:54, 405.33s/it] 27%|██▋       | 27/100 [1:42:29<6:36:53, 326.21s/it] 28%|██▊       | 28/100 [1:45:12<5:32:40, 277.22s/it] 29%|██▉       | 29/100 [1:46:03<4:07:53, 209.49s/it] 30%|███       | 30/100 [1:53:39<5:30:44, 283.49s/it]                                                      30%|███       | 30/100 [1:53:39<5:30:44, 283.49s/it] 31%|███       | 31/100 [1:56:25<4:45:14, 248.03s/it] 32%|███▏      | 32/100 [1:58:08<3:51:45, 204.49s/it] 33%|███▎      | 33/100 [2:08:44<6:13:07, 334.14s/it] 34%|███▍      | 34/100 [2:10:28<4:51:25, 264.93s/it] 35%|███▌      | 35/100 [2:11:59<3:50:40, 212.93s/it] 36%|███▌      | 36/100 [2:13:55<3:15:58, 183.73s/it] 37%|███▋      | 37/100 [2:14:45<2:30:44, 143.56s/it] 38%|███▊      | 38/100 [2:16:20<2:13:15, 128.96s/it] 39%|███▉      | 39/100 [2:18:04<2:03:45, 121.74s/it] 40%|████      | 40/100 [2:21:53<2:33:44, 153.74s/it]                                                      40%|████      | 40/100 [2:21:53<2:33:44, 153.74s/it] 41%|████      | 41/100 [2:28:08<3:36:26, 220.11s/it] 42%|████▏     | 42/100 [2:35:58<4:45:18, 295.14s/it] 43%|████▎     | 43/100 [2:37:13<3:37:30, 228.96s/it] 44%|████▍     | 44/100 [2:37:45<2:38:45, 170.10s/it] 45%|████▌     | 45/100 [2:39:21<2:15:21, 147.66s/it] 46%|████▌     | 46/100 [2:41:12<2:03:08, 136.82s/it] 47%|████▋     | 47/100 [2:45:10<2:27:44, 167.26s/it] 48%|████▊     | 48/100 [2:46:36<2:03:39, 142.68s/it] 49%|████▉     | 49/100 [2:48:02<1:46:51, 125.72s/it] 50%|█████     | 50/100 [2:52:24<2:18:51, 166.63s/it]                                                      50%|█████     | 50/100 [2:52:24<2:18:51, 166.63s/it] 51%|█████     | 51/100 [2:53:09<1:46:19, 130.19s/it] 52%|█████▏    | 52/100 [2:58:24<2:28:22, 185.48s/it] 53%|█████▎    | 53/100 [3:05:15<3:18:28, 253.37s/it] 54%|█████▍    | 54/100 [3:08:58<3:07:16, 244.26s/it] 55%|█████▌    | 55/100 [3:15:14<3:32:39, 283.54s/it] 56%|█████▌    | 56/100 [3:24:20<4:25:45, 362.40s/it] 57%|█████▋    | 57/100 [3:26:38<3:31:32, 295.19s/it] 58%|█████▊    | 58/100 [3:27:13<2:31:50, 216.93s/it] 59%|█████▉    | 59/100 [3:30:16<2:21:21, 206.86s/it] 60%|██████    | 60/100 [3:34:47<2:30:43, 226.09s/it]                                                      60%|██████    | 60/100 [3:34:47<2:30:43, 226.09s/it] 61%|██████    | 61/100 [3:37:41<2:16:48, 210.47s/it] 62%|██████▏   | 62/100 [3:41:07<2:12:27, 209.15s/it] 63%|██████▎   | 63/100 [3:43:09<1:52:50, 183.00s/it] 64%|██████▍   | 64/100 [3:44:01<1:26:16, 143.80s/it] 65%|██████▌   | 65/100 [3:45:28<1:13:48, 126.53s/it] 66%|██████▌   | 66/100 [3:52:14<1:59:15, 210.45s/it] 67%|██████▋   | 67/100 [3:54:12<1:40:25, 182.58s/it] 68%|██████▊   | 68/100 [3:55:19<1:18:55, 147.99s/it] 69%|██████▉   | 69/100 [4:05:50<2:31:21, 292.96s/it] 70%|███████   | 70/100 [4:06:50<1:51:28, 222.95s/it]                                                      70%|███████   | 70/100 [4:06:50<1:51:28, 222.95s/it] 71%|███████   | 71/100 [4:08:13<1:27:30, 181.06s/it] 72%|███████▏  | 72/100 [4:14:05<1:48:28, 232.45s/it] 73%|███████▎  | 73/100 [4:16:09<1:29:54, 199.80s/it] 74%|███████▍  | 74/100 [4:18:49<1:21:22, 187.78s/it] 75%|███████▌  | 75/100 [4:21:38<1:15:53, 182.13s/it] 76%|███████▌  | 76/100 [4:29:52<1:50:16, 275.68s/it] 77%|███████▋  | 77/100 [4:31:50<1:27:38, 228.65s/it] 78%|███████▊  | 78/100 [4:35:46<1:24:36, 230.76s/it] 79%|███████▉  | 79/100 [4:37:45<1:09:01, 197.20s/it] 80%|████████  | 80/100 [4:43:50<1:22:30, 247.51s/it]                                                      80%|████████  | 80/100 [4:43:50<1:22:30, 247.51s/it] 81%|████████  | 81/100 [4:50:57<1:35:25, 301.32s/it] 82%|████████▏ | 82/100 [4:55:31<1:27:55, 293.08s/it] 83%|████████▎ | 83/100 [4:56:44<1:04:22, 227.21s/it] 84%|████████▍ | 84/100 [4:58:55<52:50, 198.18s/it]   85%|████████▌ | 85/100 [5:04:58<1:01:57, 247.81s/it] 86%|████████▌ | 86/100 [5:07:14<50:00, 214.30s/it]   87%|████████▋ | 87/100 [5:09:10<40:00, 184.68s/it] 88%|████████▊ | 88/100 [5:11:33<34:27, 172.29s/it] 89%|████████▉ | 89/100 [5:19:23<47:57, 261.59s/it] 90%|█████████ | 90/100 [5:20:49<34:47, 208.78s/it]                                                    90%|█████████ | 90/100 [5:20:49<34:47, 208.78s/it] 91%|█████████ | 91/100 [5:23:43<29:45, 198.43s/it] 92%|█████████▏| 92/100 [5:24:45<20:59, 157.48s/it] 93%|█████████▎| 93/100 [5:25:39<14:44, 126.33s/it] 94%|█████████▍| 94/100 [5:30:53<18:16, 182.67s/it] 95%|█████████▌| 95/100 [5:31:29<11:34, 138.87s/it] 96%|█████████▌| 96/100 [5:33:27<08:49, 132.49s/it] 97%|█████████▋| 97/100 [5:34:34<05:38, 112.87s/it] 98%|█████████▊| 98/100 [5:38:57<05:15, 157.87s/it] 99%|█████████▉| 99/100 [5:49:31<05:00, 300.59s/it]100%|██████████| 100/100 [5:52:22<00:00, 261.81s/it]                                                    100%|██████████| 100/100 [5:52:22<00:00, 261.81s/it]                                                    100%|██████████| 100/100 [5:52:22<00:00, 261.81s/it]100%|██████████| 100/100 [5:52:22<00:00, 211.43s/it]
{'loss': 0.0, 'grad_norm': 0.0001810328394640237, 'learning_rate': 4.877641290737883e-07, 'completion_length': 386.55, 'rewards/format_reward_func': 0.1, 'rewards/equation_reward_func': 0.0, 'reward': 0.1, 'reward_std': 0.1414213538169861, 'kl': 0.00035761669278144836, 'epoch': 2.5}
{'loss': 0.0, 'grad_norm': 0.20586903393268585, 'learning_rate': 4.5225424859373684e-07, 'completion_length': 382.2, 'rewards/format_reward_func': 0.5, 'rewards/equation_reward_func': 0.0, 'reward': 0.5, 'reward_std': 0.42426406145095824, 'kl': 0.0005637383350403979, 'epoch': 5.0}
{'loss': 0.0, 'grad_norm': 0.21534258127212524, 'learning_rate': 3.9694631307311825e-07, 'completion_length': 433.4, 'rewards/format_reward_func': 0.4, 'rewards/equation_reward_func': 0.0, 'reward': 0.4, 'reward_std': 0.2828427076339722, 'kl': 0.0005828175460919737, 'epoch': 7.5}
{'loss': 0.0, 'grad_norm': 1.664099545450881e-05, 'learning_rate': 3.272542485937368e-07, 'completion_length': 329.1, 'rewards/format_reward_func': 0.35, 'rewards/equation_reward_func': 0.0, 'reward': 0.35, 'reward_std': 0.3535533845424652, 'kl': 0.0005529642367037013, 'epoch': 10.0}
{'loss': 0.0, 'grad_norm': 0.1860731840133667, 'learning_rate': 2.5e-07, 'completion_length': 346.2, 'rewards/format_reward_func': 0.55, 'rewards/equation_reward_func': 0.0, 'reward': 0.55, 'reward_std': 0.49497473835945127, 'kl': 0.000541963946307078, 'epoch': 12.5}
{'loss': 0.0, 'grad_norm': 3.4347816836088896e-05, 'learning_rate': 1.7274575140626315e-07, 'completion_length': 442.35, 'rewards/format_reward_func': 0.35, 'rewards/equation_reward_func': 0.0, 'reward': 0.35, 'reward_std': 0.3535533845424652, 'kl': 0.0005315755086485296, 'epoch': 15.0}
{'loss': 0.0, 'grad_norm': 0.19414924085140228, 'learning_rate': 1.0305368692688174e-07, 'completion_length': 337.3, 'rewards/format_reward_func': 0.4, 'rewards/equation_reward_func': 0.0, 'reward': 0.4, 'reward_std': 0.42426406145095824, 'kl': 0.0004842475726036355, 'epoch': 17.5}
{'loss': 0.0, 'grad_norm': 0.15461957454681396, 'learning_rate': 4.774575140626316e-08, 'completion_length': 430.0, 'rewards/format_reward_func': 0.35, 'rewards/equation_reward_func': 0.0, 'reward': 0.35, 'reward_std': 0.3535533845424652, 'kl': 0.0005884776415769011, 'epoch': 20.0}
{'loss': 0.0, 'grad_norm': 1.8376074876869097e-05, 'learning_rate': 1.2235870926211616e-08, 'completion_length': 363.75, 'rewards/format_reward_func': 0.4, 'rewards/equation_reward_func': 0.0, 'reward': 0.4, 'reward_std': 0.42426406145095824, 'kl': 0.000555477401940152, 'epoch': 22.5}
{'loss': 0.0, 'grad_norm': 0.21216867864131927, 'learning_rate': 0.0, 'completion_length': 375.7, 'rewards/format_reward_func': 0.35, 'rewards/equation_reward_func': 0.0, 'reward': 0.35, 'reward_std': 0.3535533845424652, 'kl': 0.0005078203976154327, 'epoch': 25.0}
{'train_runtime': 21142.8256, 'train_samples_per_second': 0.005, 'train_steps_per_second': 0.005, 'train_loss': 5.25028360698343e-07, 'epoch': 25.0}
